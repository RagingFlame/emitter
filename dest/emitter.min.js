!function(a){"use strict";var b,c,Emitter,d,e,f,g,h;Emitter="undefined"!=typeof exports?exports:a.Emitter={},g=a.isEmpty=function(a){if(Object.keys)return 0===Object.keys(a).length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},d=a.typeOf=function(a){if(null===a)return"null";if(a&&(1===a.nodeType||9===a.nodeType))return"element";var b=Object.prototype.toString.call(a),c=b.match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===c){if(isNaN(a))return"nan";if(!isFinite(a))return"infinity"}return c},f=a.clone=function(a){var b,c;return a.apply?(b=function(){return a.apply(this,arguments)},c=function(){},c.prototype=a.prototype,b.prototype=new c,b.prototype.constructor=b,b):a},e=a._once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},b=a.eventsApi=function(a,b,c,e){if(!c)return!0;var f,g=/\s+/;if("object"===d(c)){for(f in c)a[b].apply(a,[f,c[f]].concat(e));return!1}if(g.test(c)){var h,i,j=c.split(g);for(h=0,i=j.length;i>h;h++)a[b].apply(a,[j[h]].concat(e));return!1}return!0},c=a.triggerEvents=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},h=a.eventsFactory=function(){return{on:function(a,c,d){if(!b(this,"on",a,[c,d])||!c)return this;this._events||(this._events={});var e=this._events[a];return e||(e=this._events[a]=[]),e.push({callback:c,context:d,ctx:d||this}),this},once:function(a,c,d){if(!b(this,"once",a,[c,d])||!c)return this;var f=this,g=e(function(){f.off(a,g),c.apply(this,arguments)});return g._callback=c,this.on(a,g,d)},off:function(a,c,d){var e,f,g,h,i,j,k,l;if(!this._events||!b(this,"off",a,[c,d]))return this;if(!a&&!c&&!d)return this._events={},this;for(h=a?[a]:Object.keys(this._events),i=0,j=h.length;j>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=e=[],c||d)for(k=0,l=g.length;l>k;k++)f=g[k],(c&&c!==f.callback&&c!==f.callback._callback||d&&d!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},emit:function(a){if(!this._events)return this;var d,e,f=[].slice.call(arguments,1);return b(this,"emit",a,f)?(d=this._events[a],e=this._events.all,d&&c(d,f),e&&c(e,arguments),this):this},listenTo:function(a,b,c){var e=this._listeners||(this._listeners={}),f=a._listenerId||(a._listenerId="id_"+Date.now());return e[f]=a,"object"===d(b)&&(c=this),a.on(b,c,this),this},listenToOnce:function(a,b,c){var e=this._listeners||(this._listeners={}),f=a._listenerId||(a._listenerId="id_"+Date.now());return e[f]=a,"object"===d(b)&&(c=this),a.once(b,c,this),this},stopListening:function(a,b,c){var e,f,h=this._listeningTo;if(!h)return this;e=!b&&!c,c||"object"!==d(b)||(c=this),a&&((h={})[a._listenId]=a);for(f in h)a=h[f],a.off(b,c,this),(e||g(a._events))&&delete this._listeningTo[f];return this}}},Emitter.extend=function(){var a,b,c,e,g=[].slice.call(arguments),i=h();if(g.length>2)throw new Error("Too many arguments");if(1===g.length)e=function(){},c=g[0],e.prototype=i;else if(e=g[0],c=g[1],"function"===d(e)){e=f(e);for(a in i)e.prototype[a]=i[a]}else if("object"===d(e))for(a in i)e[a]=i[a];if("object"===d(c)||"function"===d(c)){"function"===d(c)&&(c=c.prototype);for(b in c)c.hasOwnProperty(b)&&("function"===d(e)?e.prototype[b]=c[b]:e[b]=c[b])}return e}}(this);