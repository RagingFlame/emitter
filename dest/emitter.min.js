!function(root){"use strict";var eventsApi,triggerEvents,Emitter,_typeOf,_once,_clone,isEmpty,eventsFactory;Emitter="undefined"!=typeof exports?exports:root.Emitter={},isEmpty=function(obj){if(Object.keys)return 0===Object.keys(obj).length;for(var prop in obj)if(obj.hasOwnProperty(prop))return!1;return!0},_typeOf=root._typeOf=function(o){if(null===o)return"null";if(o&&(1===o.nodeType||9===o.nodeType))return"element";var s=Object.prototype.toString.call(o),type=s.match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===type){if(isNaN(o))return"nan";if(!isFinite(o))return"infinity"}return type},_clone=root._clone=function(fn){var key,temp;if(!fn.apply)return fn;temp=function(){return fn.apply(this,arguments)};for(key in fn)temp[key]=fn[key];return temp},_once=root._once=function(func){var memo,ran=!1;return function(){return ran?(console.log("has been called"),memo):(ran=!0,memo=func.apply(this,arguments),func=null,memo)}},eventsApi=root.eventsApi=function(obj,action,name,rest){if(!name)return!0;var key,eventSplitter=/\s+/;if("object"===_typeOf(name)){for(key in name)obj[action].apply(obj,[key,name[key]].concat(rest));return!1}if(eventSplitter.test(name)){var i,l,names=name.split(eventSplitter);for(i=0,l=names.length;l>i;i++)obj[action].apply(obj,[names[i]].concat(rest));return!1}return!0},triggerEvents=root.triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args)}},eventsFactory=root.eventsFactory=function(){return{on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name];return events||(events=this._events[name]=[]),events.push({callback:callback,context:context,ctx:context||this}),this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=_once(function(){self.off(name,once),callback.apply(this,arguments)});return once._callback=callback,this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._events={},this;for(names=name?[name]:Object.keys(this._events),i=0,l=names.length;l>i;i++)if(name=names[i],events=this._events[name]){if(this._events[name]=retain=[],callback||context)for(j=0,k=events.length;k>j;j++)ev=events[j],(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev);retain.length||delete this._events[name]}return this},emit:function(name){if(!this._events)return this;var events,allEvents,args=[].slice.call(arguments,1);return eventsApi(this,"emit",name,args)?(events=this._events[name],allEvents=this._events.all,events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,arguments),this):this},listenTo:function(obj,name,callback){var listeners=this._listeners||(this._listeners={}),id=obj._listenerId||(obj._listenerId="id_"+Date.now());return listeners[id]=obj,"object"===_typeOf(name)&&(callback=this),obj.on(name,callback,this),this},listenToOnce:function(obj,name,callback){var listeners=this._listeners||(this._listeners={}),id=obj._listenerId||(obj._listenerId="id_"+Date.now());return listeners[id]=obj,"object"===_typeOf(name)&&(callback=this),obj.once(name,callback,this),this},stopListening:function(obj,name,callback){var remove,id,listeningTo=this._listeningTo;if(!listeningTo)return this;remove=!name&&!callback,callback||"object"!==_typeOf(name)||(callback=this),obj&&((listeningTo={})[obj._listenId]=obj);for(id in listeningTo)obj=listeningTo[id],obj.off(name,callback,this),(remove||isEmpty(obj._events))&&delete this._listeningTo[id];return this}}},Emitter.extend=function(){var event,prop,props,Parent,args=[].slice.call(arguments),events=eventsFactory();if(args.length>2)throw new Error("Too many arguments");if(1===args.length)Parent=function(){},props=args[0],Parent.prototype=events;else if(Parent=args[0],props=args[1],"function"===_typeOf(Parent)){Parent=_clone(Parent);for(event in events)Parent.prototype[event]=events[event]}else if("object"===_typeOf(Parent))for(event in events)Parent[event]=events[event];if("object"===_typeOf(props)||"function"===_typeOf(props)){"function"===_typeOf(props)&&(props=props.prototype);for(prop in props)props.hasOwnProperty(prop)&&("function"===_typeOf(Parent)?Parent.prototype[prop]=props[prop]:Parent[prop]=props[prop])}return Parent}}(this);